<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookSite - ููุชุจุฉ ุงููุชุจ ุงูุฅููุชุฑูููุฉ</title>
    <!-- ุชุถููู ุฎุท Inter ูุชุญููู Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="js/upload.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* ุฅุนุฏุงุฏุงุช ุงูุฎุท ุงูุงูุชุฑุงุถูุฉ ูุงูุชูุฑูุฑ ุงูุณูุณ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* ุฎูููุฉ ุฏุงููุฉ ุฌุฐุงุจุฉ */
            color: #e4e4e7; /* ูุต ูุงุชุญ */
            scroll-behavior: smooth;
        }
        /* ุชุตููู ุดุฑูุท ุงูุชูุฑูุฑ ูุฎุตุต ูุฌูุงููุฉ ุฃูุจุฑ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2c2c4d;
        }
        ::-webkit-scrollbar-thumb {
            background: #6246e9;
            border-radius: 10px;
        }
        /* ุฃููุงุท ุงูุจุทุงูุฉ ุนูุฏ ุงูุชุญููู ูุฒูุงุฏุฉ ุงูุชูุงุนู */
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(98, 70, 233, 0.4);
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- ุดุฑูุท ุงูุชููู (Header) - ุซุงุจุช ููุชุฌุงูุจ -->
    <header class="sticky top-0 z-50 bg-[#16213e] shadow-lg">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col md:flex-row justify-between items-center">
            <!-- ุงุณู ุงููููุน -->
            <h1 class="text-3xl font-bold text-[#e94560] mb-4 md:mb-0">
                BookSite
            </h1>

            <!-- ูุงุฆูุฉ ุงูุฃูุณุงู ุงูุฑุฆูุณูุฉ (ุณุชุณุชุฎุฏู ูููุงุชุฑ ุจูุงุณุทุฉ JS) -->
            <nav id="category-nav">
                <ul class="flex flex-wrap justify-center md:justify-end space-x-2 space-x-reverse md:space-x-4 md:space-x-reverse text-sm font-medium">
                    <li><button data-category="ุงููู" class="nav-button p-2 rounded-lg transition duration-300 hover:bg-[#533e85] bg-[#6246e9] text-white shadow-md">ุงููู</button></li>
                    <li><button data-category="ุฑูุงูุงุช" class="nav-button p-2 rounded-lg transition duration-300 hover:bg-[#533e85] text-gray-300">ุฑูุงูุงุช</button></li>
                    <li><button data-category="ูุชุจ ุนูููุฉ" class="nav-button p-2 rounded-lg transition duration-300 hover:bg-[#533e85] text-gray-300">ูุชุจ ุนูููุฉ</button></li>
                    <li><button data-category="ุชุทููุฑ ุดุฎุตู" class="nav-button p-2 rounded-lg transition duration-300 hover:bg-[#533e85] text-gray-300">ุชุทููุฑ ุดุฎุตู</button></li>
                    <li><button data-category="ูุงูุชุงุฒูุง" class="nav-button p-2 rounded-lg transition duration-300 hover:bg-[#533e85] text-gray-300">ูุงูุชุงุฒูุง</button></li>
                    <li><button data-category="ุชุงุฑูุฎ" class="nav-button p-2 rounded-lg transition duration-300 hover:bg-[#533e85] text-gray-300">ุชุงุฑูุฎ</button></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- ุงููุญุชูู ุงูุฑุฆูุณู ููููุชุจุฉ -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- ุฑุณุงูุฉ ุงูุชุฑุญูุจ ูุงูุจุญุซ -->
        <section class="mb-10 p-6 bg-[#2c2c4d] rounded-2xl shadow-xl text-center">
            <h2 class="text-4xl font-extrabold text-[#e94560] mb-2">ูุฑุญุจุงู ุจู ูู ููุชุจุฉ BookSite!</h2>
            <p class="text-gray-300 mb-6 text-lg">ุงูุชุดู ูุฌููุนุชูุง ุงููุฎุชุงุฑุฉ ูู ุฃูุถู ุงููุชุจ ูุงูุฑูุงูุงุช.</p>

            <!-- ุญูู ุงูุจุญุซ -->
            <div class="max-w-xl mx-auto">
                <input type="text" id="search-input" placeholder="ุงุจุญุซ ุจุนููุงู ุงููุชุงุจ ุฃู ุงููุคูู..."
                       class="w-full p-3 rounded-xl bg-[#1a1a2e] text-white border border-[#6246e9] focus:outline-none focus:ring-2 focus:ring-[#e94560] transition duration-300"
                       dir="rtl">
            </div>
        </section>

        <!-- ูุณู ุนุฑุถ ุงููุชุจ (ุงูุดุจูุฉ) -->
        <section id="book-list-view">
            <h3 class="text-3xl font-bold mb-6 border-b-2 border-[#6246e9] pb-2 text-white">ุงููุชุจ ุงููุชุงุญุฉ</h3>
            <!-- ูุฐุง ุงูุญุงููุฉ ุณูุชู ููุคูุง ุจุจุทุงูุงุช ุงููุชุจ ุจูุงุณุทุฉ JavaScript -->
            <div id="books-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- ุฃูุซูุฉ ูุจุทุงูุงุช ุงููุชุจ ุณุชุธูุฑ ููุง -->
            </div>

            <!-- ุฑุณุงูุฉ ุนุฏู ูุฌูุฏ ูุชุงุฆุฌ (ูุฎููุฉ ูุจุฏุฆูุงู) -->
            <div id="no-results" class="hidden text-center p-10 bg-[#2c2c4d] rounded-xl mt-10">
                <p class="text-xl text-gray-400">ุนุฐุฑุงูุ ูุง ุชูุฌุฏ ูุชุจ ูุทุงุจูุฉ ูุนูููุฉ ุงูุจุญุซ ุฃู ุงูููุชุฑุฉ ุญุงููุงู.</p>
            </div>
        </section>

        <!-- ูุณู ุนุฑุถ ุชูุงุตูู ุงููุชุงุจ (ูุฎูู ูุจุฏุฆูุงู) -->
        <!-- ุณูุธูุฑ ูุฐุง ุงููุณู ุนูุฏูุง ูุถุบุท ุงููุณุชุฎุฏู ุนูู ูุชุงุจ ูุนูู -->
        <section id="book-detail-view" class="hidden">
            <button id="back-to-list" class="flex items-center text-[#e94560] hover:text-[#ff6b81] transition duration-300 mb-6 font-semibold">
                <!-- ุณูู ููุนูุฏุฉ -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
                ุงูุนูุฏุฉ ุฅูู ูุงุฆูุฉ ุงููุชุจ
            </button>

            <!-- ููุง ุณูุชู ุญูู ุชูุงุตูู ุงููุชุงุจ ุงููุฎุชุงุฑ ุจูุงุณุทุฉ JavaScript -->
            <div id="detail-content" class="bg-[#2c2c4d] p-8 rounded-2xl shadow-2xl">
                <!-- ุชูุงุตูู ุงููุชุงุจ ุณุชุธูุฑ ููุง -->
            </div>
        </section>

    </main>

    <!-- ๐งฉ ูุณู ุงูุฅุถุงูุฉ ุงููุฎูู (ูููุฐุฌ ุชูููุฏ ููุฏ ูุชุงุจ ุฌุฏูุฏ) -->
<section id="admin-upload" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
  <div class="bg-[#2c2c4d] p-8 rounded-2xl w-full max-w-lg shadow-2xl relative">
    <button id="close-admin" class="absolute top-3 right-3 text-gray-400 hover:text-white">โ</button>
    <h2 class="text-2xl font-bold text-[#e94560] mb-4 text-center">ุฅุถุงูุฉ ูุชุงุจ ุฌุฏูุฏ</h2>

    <form id="book-form" class="space-y-4">
      <!-- ูุคุดุฑ ุญุงูุฉ ุงูุฑูุน -->
      <div id="upload-status" class="hidden">
        <div class="flex items-center justify-center space-x-2 space-x-reverse mb-4">
          <div class="animate-spin h-5 w-5 border-2 border-[#e94560] border-t-transparent rounded-full"></div>
          <span class="text-[#e94560] font-semibold" id="upload-status-text">ุฌุงุฑู ุฑูุน ุงููููุงุช...</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">
          <div id="upload-progress" class="bg-[#e94560] h-2.5 rounded-full transition-all duration-300 ease-in-out" style="width: 0%"></div>
        </div>
      </div>

            <!-- ุฑุณุงูุฉ ุงูุฎุทุฃ -->
            <div id="error-message" class="hidden mt-4 p-4 text-sm text-red-500 bg-red-100 rounded-lg"></div>

            <!-- ุฒุฑ ุงุฎุชุจุงุฑ ุฎุฏูุฉ ุงูุฑูุน ูุญุงูุฉ ุงูุงุณุชุฌุงุจุฉ -->
            <div class="mt-2 flex items-center gap-3">
                <button type="button" id="test-upload-endpoint" class="px-3 py-2 bg-[#6246e9] text-white rounded hover:bg-[#7b66ff]">ุงุฎุชุจุงุฑ ุฎุฏูุฉ ุงูุฑูุน</button>
                <span id="endpoint-test-status" class="text-sm text-gray-300 hidden"></span>
            </div>

      <input type="text" id="title" placeholder="ุนููุงู ุงููุชุงุจ" class="w-full p-2 rounded bg-[#16213e] text-white border border-[#6246e9]" required>
      <input type="text" id="author" placeholder="ุงุณู ุงููุคูู" class="w-full p-2 rounded bg-[#16213e] text-white border border-[#6246e9]" required>
      <input type="text" id="category" placeholder="ุงูุชุตููู (ูุซูุงู: ุฑูุงูุงุช)" class="w-full p-2 rounded bg-[#16213e] text-white border border-[#6246e9]" required>
<!-- ุฑูุน ุงูุบูุงู -->
<label class="block mt-2 mb-1 font-semibold text-gray-700">๐ ุบูุงู ุงููุชุงุจ:</label>
<input id="cover-file" type="file" accept="image/*"
       class="w-full border p-2 rounded-md focus:ring-2 focus:ring-blue-400" required>

<!-- ุฑูุน ุงููุชุงุจ PDF -->
<label class="block mt-2 mb-1 font-semibold text-gray-700">๐ ููู ุงููุชุงุจ (PDF):</label>
<input id="pdf-file" type="file" accept="application/pdf"
       class="w-full border p-2 rounded-md focus:ring-2 focus:ring-blue-400" required>

      <textarea id="summary" placeholder="ููุฎุต ูุตูุฑ" class="w-full p-2 rounded bg-[#16213e] text-white border border-[#6246e9]" required></textarea>
      <button type="submit" class="w-full bg-[#e94560] text-white font-bold py-2 rounded hover:bg-[#ff6b81] transition">ุชูููุฏ ููุฏ ุงููุชุงุจ</button>
    </form>

    <div id="generated-code" class="hidden mt-6">
      <h3 class="text-lg text-gray-300 mb-2">ุงูุณุฎ ุงูููุฏ ุฃุฏูุงู ูุถุนู ุฏุงุฎู <code>booksData</code>:</h3>
      <pre class="bg-[#16213e] text-sm text-green-400 p-3 rounded overflow-x-auto"></pre>
    </div>
  </div>
</section>

<!-- ๐ข ุฅุดุนุงุฑ ูุฌุงุญ ุชูููุฏ ุงูููุฏ -->
<div id="success-alert" 
     class="hidden fixed top-6 left-1/2 transform -translate-x-1/2 bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg font-semibold z-50">
  โ ุชู ุฅูุดุงุก ููุฏ ุงููุชุงุจ ุจูุฌุงุญ!
</div>


<!-- ุฒุฑ ุณุฑู ููุชุญ ููุญุฉ ุงูุฅุถุงูุฉ (ููุณุชุฎุฏู ููููุจุงูู) -->
<!-- ุฒุฑ ุณุฑู ููุชูุจ ุนููู M -->
<button id="secret-admin-btn"
        class="fixed bottom-4 right-4 w-10 h-10 flex items-center justify-center rounded-full bg-[#e94560] text-white text-sm font-bold opacity-60 hover:opacity-90 focus:opacity-100 shadow-lg z-50"
        title="ููุชุงุญ ุงููุดุฑู" aria-label="ููุชุงุญ ุงููุดุฑู">
  M
</button>



    <!-- ุงูุชุฐููู (Footer) -->
    <footer class="bg-[#16213e] mt-12 py-6 text-center text-gray-400">
        <p>&copy; 2025 BookSite - ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
    </footer>

    <!-- ููู JavaScript ูุฌููุน ุงููุธุงุฆู ูุงูููุทู -->
    <script>
        // ุชุฃูุฏ ูู ุชุญููู ุงูููู
        if (typeof handleBookUpload === 'undefined') {
            console.error('ุฎุทุฃ: ูู ูุชู ุชุญููู ููู upload.js');
        }

        // ุฑุจุท ุงููููุฐุฌ ุจูุนุงูุฌ ุงูุฑูุน
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('book-form');
            if (form) {
                form.addEventListener('submit', handleBookUpload);
                console.log('ุชู ุฑุจุท ุงููููุฐุฌ ุจูุนุงูุฌ ุงูุฑูุน');
            } else {
                console.error('ุฎุทุฃ: ูู ูุชู ุงูุนุซูุฑ ุนูู ุงููููุฐุฌ');
            }
        });

        // ุญุงูุฉ ุงููุตุงุฏูุฉ ุงูุฎุงุตุฉ ุจุงููุดุฑู (ูุนุฑูุถุฉ ููุท ููุตูุญุฉ ุงูุนููู)
        window.isAdminAuthenticated = false;

        // ูุงุฆูุฉ ุงููุชุจ (ุณูููู ุญุฐู ุงููุชุจ ูุญููุงู ูููุญูุธ ูู localStorage)
        let booksData = [];

        // ุชุญููู ูุงุฆูุฉ ุงูุญุฐู ุงููุญููุธุฉ ูู localStorage
        function loadDeletedList() {
            try {
                return JSON.parse(localStorage.getItem('deletedBooks') || '[]');
            } catch (e) {
                return [];
            }
        }

        // ุญูุธ ูุงุฆูุฉ ุงูุญุฐู
        function saveDeletedList(list) {
            localStorage.setItem('deletedBooks', JSON.stringify(list));
        }

        // 2. ุนูุงุตุฑ DOM ุงูุฑุฆูุณูุฉ
        const elements = {
            booksContainer: document.getElementById('books-container'),
            searchIinput: document.getElementById('search-input'),
            navButtons: document.querySelectorAll('.nav-button'),
            bookListView: document.getElementById('book-list-view'),
            bookDetailView: document.getElementById('book-detail-view'),
            detailContent: document.getElementById('detail-content'),
            backToListButton: document.getElementById('back-to-list'),
            noResultsMessage: document.getElementById('no-results')
        };

    let currentCategory = 'ุงููู';
    let searchTerm = '';

    // 4. ูุธุงุฆู ุงูุนุฑุถ ูุงูููุทู

        /**
         * ุฅูุดุงุก ุจุทุงูุฉ HTML ููุชุงุจ ูุงุญุฏ.
         * ุชู ุฅุฒุงูุฉ ุฒุฑ 'ูุดุงูุฏุฉ ุงูุชูุงุตูู' ูุฌุนู ุงูุจุทุงูุฉ ูููุง ููุทูุฉ ููุฑ ูุงุญุฏุฉ.
         * @param {Object} book - ูุงุฆู ุงููุชุงุจ.
         * @returns {string} - ุณูุณูุฉ HTML ูุจุทุงูุฉ ุงููุชุงุจ.
         */
        function createBookCard(book) {
            return `
                <div data-id="${book.id}" class="book-card bg-[#16213e] p-4 rounded-xl shadow-lg cursor-pointer transition duration-300 ease-in-out transform hover:scale-[1.03]">
                    <div class="flex flex-col h-full">
                        <img src="${book.cover}" alt="ุบูุงู ูุชุงุจ ${book.title}" 
                             onerror="this.onerror=null;this.src='https://placehold.co/200x300/5C7AEA/ffffff?text=ุบูุงู+ุบูุฑ+ููุฌูุฏ'" 
                             class="w-full h-auto object-cover rounded-lg mb-4 shadow-md aspect-[2/3]">
                        <div class="flex-grow">
                            <h4 class="text-xl font-bold text-white mb-1 truncate">${book.title}</h4>
                            <p class="text-[#e94560] text-sm mb-2 font-medium">${book.author}</p>
                            <span class="inline-block bg-[#2c2c4d] text-gray-300 text-xs font-semibold px-3 py-1 rounded-full mb-3">${book.category}</span>
                            <p class="text-gray-400 text-sm mb-4 line-clamp-3">${book.summary}</p>
                        </div>
                        <!-- ุชู ุฅุฒุงูุฉ ุฒุฑ 'ูุดุงูุฏุฉ ุงูุชูุงุตูู' ูุฌุนู ุงูุจุทุงูุฉ ูููุง ูุงุจูุฉ ููููุฑ -->
                    </div>
                </div>
            `;
        }

        /**
         * ุนุฑุถ ุชูุงุตูู ูุชุงุจ ูุนูู ุนูุฏ ุงูููุฑ ุนููู.
         * @param {Object} book - ูุงุฆู ุงููุชุงุจ ุงููุฑุงุฏ ุนุฑุถู.
         */
        function showBookDetails(book) {
            elements.bookListView.classList.add('hidden');
            elements.bookDetailView.classList.remove('hidden');
            // ุชุชุจุน ุงููุชุงุจ ุงูุญุงูู ูุชูููู ุฅุนุงุฏุฉ ุงูุนุฑุถ ุจุนุฏ ุงููุตุงุฏูุฉ
            window.currentBookId = book.id;

            elements.detailContent.innerHTML = `
                <div class="flex flex-col lg:flex-row gap-8">
                    <!-- ุงูุบูุงู (ุงูุฌุงูุจ ุงูุฃููู) -->
                    <div class="flex-shrink-0 lg:w-1/3">
                         <img src="${book.cover}" alt="ุบูุงู ูุชุงุจ ${book.title}" 
                              onerror="this.onerror=null;this.src='https://placehold.co/200x300/5C7AEA/ffffff?text=ุบูุงู+ุบูุฑ+ููุฌูุฏ'" 
                              class="w-full max-w-xs mx-auto lg:max-w-none rounded-xl shadow-2xl aspect-[2/3] object-cover">
                    </div>

                    <!-- ุงูุชูุงุตูู (ุงูุฌุงูุจ ุงูุฃูุณุฑ) -->
                    <div class="lg:w-2/3">
                        <h2 class="text-4xl font-extrabold text-[#e94560] mb-2">${book.title}</h2>
                        <h3 class="text-2xl font-semibold text-white mb-4">ูููุงุชุจ: ${book.author}</h3>

                        <div class="mb-6 space-y-3">
                            <span class="inline-block bg-[#6246e9] text-white text-md font-bold px-4 py-1 rounded-full shadow-md">
                                ุงูุชุตููู: ${book.category}
                            </span>
                        </div>

                        <div class="mb-8">
                            <h4 class="text-xl font-bold text-gray-300 mb-2">ูุตู ูุฎุชุตุฑ</h4>
                            <p class="text-gray-300 leading-relaxed">${book.description}</p>
                        </div>

                        <!-- ุฃุฒุฑุงุฑ ุงูุชุญููู ูุงููุนุงููุฉ -->
<div class="flex flex-wrap gap-4">
  <button onclick="openPreviewModal('${book.downloadUrl}')"
    class="inline-flex items-center justify-center px-8 py-3 bg-[#6246e9] text-white font-bold rounded-xl shadow-lg hover:bg-[#7b66ff] transition duration-300 transform hover:scale-105">
    ๐๏ธ ูุนุงููุฉ ุงููุชุงุจ
  </button>

  <a href="${book.downloadUrl}" download="${book.title}.pdf"
     class="inline-flex items-center justify-center px-8 py-3 bg-[#e94560] text-white font-bold rounded-xl shadow-lg hover:bg-[#ff6b81] transition duration-300 transform hover:scale-105">
     <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 ml-3" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L10 11.586l2.293-2.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
      ุชูุฒูู ุงููุชุงุจ ุงูุขู (PDF)
  </a>
</div>

<!-- ุฒุฑ ุงูุญุฐู ูุธูุฑ ููุท ุฅุฐุง ูุงู ุงูููุดุฑู ูุตุงุฏู -->
${window.isAdminAuthenticated ? `
    <div class="mt-6">
        <button onclick="deleteBook('${book.id}')" class="w-full inline-flex items-center justify-center px-6 py-3 bg-red-600 text-white font-bold rounded-xl shadow-lg hover:bg-red-700 transition">ุญุฐู ุงููุชุงุจ ููุงุฆูุงู</button>
    </div>
` : ''}

                    </div>
                </div>
            `;
            // ุงูุชูุฑูุฑ ูุฃุนูู ุงูุตูุญุฉ ุนูุฏ ุนุฑุถ ุงูุชูุงุตูู
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        /**
         * ุนุฑุถ ูุงุฆูุฉ ุงููุชุจ ูุฅุฎูุงุก ุตูุญุฉ ุงูุชูุงุตูู.
         */
        function showBookList() {
            elements.bookDetailView.classList.add('hidden');
            elements.bookListView.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        /**
         * ุชุตููุฉ ูุนุฑุถ ุงููุชุจ ุจูุงุกู ุนูู ุงููุณู ููููุฉ ุงูุจุญุซ ุงูุญุงููุฉ.
         */
        function renderBooks() {
            // 1. ุชุตููุฉ ุงูุจูุงูุงุช
            const normalizedSearch = searchTerm.toLowerCase().trim();
            const filteredBooks = booksData.filter(book => {
                // ุชุตููุฉ ุญุณุจ ุงููุณู
                const categoryMatch = currentCategory === 'ุงููู' || book.category === currentCategory;

                // ุชุตููุฉ ุญุณุจ ุงูุจุญุซ (ุงูุนููุงู ุฃู ุงููุคูู)
                const searchMatch = normalizedSearch === '' ||
                                    book.title.toLowerCase().includes(normalizedSearch) ||
                                    book.author.toLowerCase().includes(normalizedSearch);

                return categoryMatch && searchMatch;
            });

            // 2. ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู
            elements.booksContainer.innerHTML = filteredBooks.map(createBookCard).join('');

            // 3. ุนุฑุถ/ุฅุฎูุงุก ุฑุณุงูุฉ ุนุฏู ูุฌูุฏ ูุชุงุฆุฌ
            if (filteredBooks.length === 0) {
                elements.noResultsMessage.classList.remove('hidden');
            } else {
                elements.noResultsMessage.classList.add('hidden');
            }

            // 4. ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ ูุจุทุงูุงุช ุงููุชุจ ุงูุฌุฏูุฏุฉ (ุงูุจุทุงูุฉ ุจุฃููููุง ูุงุจูุฉ ููููุฑ)
            document.querySelectorAll('.book-card').forEach(card => {
                card.addEventListener('click', () => {
                    const bookId = card.dataset.id;
                    const book = booksData.find(b => b.id === bookId);
                    if (book) {
                        showBookDetails(book);
                    }
                });
            });
        }


        /**
         * ุฅุนุฏุงุฏ ูุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ ุนูุฏ ุชุญููู ุงูุตูุญุฉ.
         */
        function setupBookSite() {
            console.log("BookSite: ุฌุงูุฒ ููุนูู.");

            // ุฃ. ูุนุงูุฌุฉ ููุฑุงุช ุฃุฒุฑุงุฑ ุงูุฃูุณุงู (ุงูููุชุฑุฉ)
            elements.navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // ุชุญุฏูุซ ุญุงูุฉ ุงููุณู ุงูุญุงูู
                    currentCategory = button.dataset.category;
                    
                    // ุชุญุฏูุซ ุดูู ุงูุฒุฑ ุงููุดุท
                    elements.navButtons.forEach(btn => btn.classList.remove('bg-[#6246e9]', 'text-white', 'shadow-md'));
                    elements.navButtons.forEach(btn => btn.classList.add('text-gray-300'));
                    button.classList.add('bg-[#6246e9]', 'text-white', 'shadow-md');
                    button.classList.remove('text-gray-300');

                    // ุนุฑุถ ูุงุฆูุฉ ุงููุชุจ ูุฑุฉ ุฃุฎุฑู ูุชุทุจูู ุงูููุชุฑุฉ
                    showBookList();
                    renderBooks();
                });
            });
            
            // ุจ. ูุนุงูุฌุฉ ุงูุจุญุซ ุงูููุฑู
            elements.searchIinput.addEventListener('input', (e) => {
                searchTerm = e.target.value;
                // ูุฌุจ ุชุทุจูู ุงูููุชุฑุฉ ุนูู ูุชุงุฆุฌ ุงูุจุญุซ ุฃูุถูุง
                renderBooks();
            });

            // ุฌ. ูุนุงูุฌุฉ ุฒุฑ ุงูุนูุฏุฉ ูู ุตูุญุฉ ุงูุชูุงุตูู
            elements.backToListButton.addEventListener('click', showBookList);

            // ุฏ. ุงูุนุฑุถ ุงูุฃููู ูููุชุจ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
            renderBooks();
        }

        // ุจูุงูุงุช ุงููุชุจ ุงููุชุงุญุฉ
        booksData = [
            {
                id: 'book-001',
                title: 'ูุงุฆุฉ ุนุงู ูู ุงูุนุฒูุฉ',
                author: 'ุบุงุจุฑููู ุบุงุฑุณูุง ูุงุฑููุฒ',
                category: 'ุฑูุงูุงุช',
                summary: 'ุฑูุงูุฉ ุฎูุงููุฉ ุชุญุชูู ูุตุฉ ุนุงุฆูุฉ ุจูููุฏูุง ุนุจุฑ ุณุจุน ุฃุฌูุงู ูู ูุฑูุฉ ูุงูููุฏู ุงูุฎูุงููุฉ. ุนูู ููู ูุฌูุน ุจูู ุงููุงูุนูุฉ ูุงูุณุญุฑ.',
                description: 'ุฑูุงูุฉ "ูุงุฆุฉ ุนุงู ูู ุงูุนุฒูุฉ" ูุบุงุจุฑููู ุบุงุฑุณูุง ูุงุฑููุฒ ุชุนุชุจุฑ ูู ุฃุนุธู ุงูุฃุนูุงู ุงูุฃุฏุจูุฉ ูู ุงููุฑู ุงูุนุดุฑูู. ุชุชูุงูู ุงูุฑูุงูุฉ ูุตุฉ ุนุงุฆูุฉ ุจูููุฏูุง ุนูู ูุฏู ุณุจุนุฉ ุฃุฌูุงู ูู ูุฑูุฉ ูุงูููุฏูุ ูุชุฌูุน ุจูู ุนูุงุตุฑ ุงููุงูุนูุฉ ุงูุฎูุงููุฉ ูุงูุฃุณุงุทูุฑ ูุงูุชุงุฑูุฎ. ูุตูุฑ ุงููุงุชุจ ุงูุญุจ ูุงูููุช ูุงูุญุฑุจ ูุงูุนุฒูุฉ ูุงูุญููู ุจุทุฑููุฉ ูุฑูุฏุฉ ูุนูููุฉ.',
                cover: 'covers/ูุงุฆุฉ ุนุงู ูู ุงูุนุฒูุฉ.jpeg',
                downloadUrl: 'books/ูุงุฆุฉ ุนุงู ูู ุงูุนุฒูุฉ.pdf'
            },
            {
                id: 'book-002',
                title: 'ุงูุฅูุณุงู ูุจุญุซ ุนู ุงููุนูู',
                author: 'ูููุชูุฑ ูุฑุงููู',
                category: 'ุชุทููุฑ ุดุฎุตู',
                summary: 'ูุชุงุจ ุนููู ูุชูุงูู ูุนูู ุงูุญูุงุฉ ูู ุฎูุงู ุชุฌุฑุจุฉ ุงููุคูู ูู ูุนุณูุฑุงุช ุงูุงุนุชูุงู. ุฏุฑุณ ูู ุงูุฃูู ูุงููุฑููุฉ ุงูููุณูุฉ.',
                description: 'ูุชุงุจ "ุงูุฅูุณุงู ูุจุญุซ ุนู ุงููุนูู" ููุฏูุชูุฑ ูููุชูุฑ ูุฑุงูููุ ุงูุทุจูุจ ุงูููุณู ุงูููุณุงูู ุงูุฐู ูุฌุง ูู ูุนุณูุฑุงุช ุงูุงุนุชูุงู. ููุฏู ุงููุชุงุจ ูุธุฑูุฉ ุนูู ุงูููุณ ุงููุฌูุฏูุ ุญูุซ ูุฑู ุฃู ุงูุจุญุซ ุนู ุงููุนูู ูู ุงูุฏุงูุน ุงูุฃุณุงุณู ููุฅูุณุงู. ูุณุฑุฏ ุงููุคูู ุชุฌุฑุจุชู ุงููุคููุฉ ูู ุงููุนุณูุฑุงุช ูุงูุฏุฑูุณ ุงูุชู ุชุนูููุง ุนู ุงูุญูุงุฉ ูุงูุฃูู.',
                cover: 'covers/ุงูุฅูุณุงู ูุจุญุซ ุนู ุงููุนูู.jpg',
                downloadUrl: 'books/ุงูุฅูุณุงู ูุจุญุซ ุนู ุงููุนูู.pdf'
            },
            {
                id: 'book-003',
                title: 'ุงูููู ุงูุฃููู',
                author: 'ุจุฑุงูู ุฌุฑูู',
                category: 'ูุชุจ ุนูููุฉ',
                summary: 'ุฑุญูุฉ ูุงุชูุฉ ุนุจุฑ ุนุงูู ุงูููุฒูุงุก ุงูุญุฏูุซุฉ ูุงูููู. ุดุฑุญ ููุณุฑ ููุธุฑูุฉ ุงูุฃูุชุงุฑ ูุงูููุฒูุงุก ุงูููุงูุชูุฉ.',
                description: 'ูุชุงุจ "ุงูููู ุงูุฃููู" ููููุฒูุงุฆู ุจุฑุงูู ุฌุฑูู ููุฏู ุดุฑุญุงู ููุณุฑุงู ููุนูุฏุงุช ุงูููุฒูุงุก ุงูุญุฏูุซุฉ. ูุชูุงูู ุงููุชุงุจ ูุธุฑูุฉ ุงูุฃูุชุงุฑุ ูุงูุซููุจ ุงูุณูุฏุงุกุ ูุงูุฃุจุนุงุฏ ุงูุฅุถุงููุฉุ ูุทุจูุนุฉ ุงูุฒูู ูุงูููุงู. ูุฌูุน ุงููุคูู ุจูู ุงูุฏูุฉ ุงูุนูููุฉ ูุงููุฏุฑุฉ ุนูู ุดุฑุญ ุงูููุงููู ุงููุนูุฏุฉ ุจุทุฑููุฉ ุจุณูุทุฉ ูุฌุฐุงุจุฉ.',
                cover: 'covers/ุงูููู ุงูุฃููู.png',
                downloadUrl: 'books/ุงูููู ุงูุฃููู.pdf'
            },
            {
                id: 'book-004',
                title: 'ุชุงุฑูุฎ ููุฌุฒ ููุฒูุงู',
                author: 'ุณุชููู ูููููุฌ',
                category: 'ูุชุจ ุนูููุฉ',
                summary: 'ุงุณุชูุดุงู ุนููู ุฑุงุฆุน ูุฃุตูู ุงูููู ูุงูุซููุจ ุงูุณูุฏุงุก. ูุชุงุจ ูุดุฑุญ ุงูููู ุจูุบุฉ ูููููุฉ ููุฌููุน.',
                description: 'ูุชุงุจ "ุชุงุฑูุฎ ููุฌุฒ ููุฒูุงู" ูุณุชููู ูููููุฌ ูุนุชุจุฑ ูู ุฃูู ุงููุชุจ ุงูุนูููุฉ ุงูุญุฏูุซุฉ. ูุชูุงูู ุงููุชุงุจ ุฃุตูู ุงููููุ ูุงููุฌููุ ูุงูุซููุจ ุงูุณูุฏุงุกุ ูุงูุฒููุ ูุงููุณุจูุฉ. ููุฏู ูููููุฌ ุดุฑุญุงู ุนูููุงู ูุฃุญุฏุซ ุงููุธุฑูุงุช ุงูุนูููุฉ ุจุทุฑููุฉ ุณููุฉ ุงูููู ูููุชุนุฉ.',
                cover: 'covers/ุชุงุฑูุฎ ููุฌุฒ ููุฒูุงู.jpg',
                downloadUrl: 'books/ุชุงุฑูุฎ ููุฌุฒ ููุฒูุงู.pdf'
            },
            
            {
                id: 'book-006',
                title: 'ุฃุฑุถ ุฒููููุง',
                author: 'ูุงุชุจ ูุฌููู',
                category: 'ุชุงุฑูุฎ',
                summary: 'ุฑุญูุฉ ุนุจุฑ ุญุถุงุฑุฉ ูุฏููุฉ ูุฃุณุฑุงุฑูุง ุงููุฎููุฉ. ุฏุฑุงุณุฉ ุชุงุฑูุฎูุฉ ุนู ุญุถุงุฑุฉ ุถุงุฆุนุฉ.',
                description: 'ุฏุฑุงุณุฉ ุชุงุฑูุฎูุฉ ูููุฉ ุชุชูุงูู ุญุถุงุฑุฉ ูุฏููุฉ ูุชุงุฑูุฎูุง ุงูุนุฑูู. ููุดู ุงููุชุงุจ ุนู ุฃุณุฑุงุฑ ูุญูุงุฆู ูู ุชูู ูุนุฑููุฉ ูู ูุจู.',
                cover: 'covers/ard_zicola.jpg',
                downloadUrl: 'books/ard_zicola.pdf'
            }
        ];

        // ุฅุฒุงูุฉ ุงููุชุจ ุงูุชู ูุณูุช ููุญุฐููุฉ ุณุงุจูุงู
        (function filterDeletedOnLoad() {
            const deleted = loadDeletedList();
            if (deleted && deleted.length) {
                booksData = booksData.filter(b => !deleted.includes(b.id));
            }
        })();

                        window.onload = setupBookSite;
                        function openPreviewModal(url) {
                                window.open(url, '_blank');
                        }

                        // ููุญุฉ ุงููุดุฑู (ูุชุญ/ุฅุบูุงู)
                        window.addEventListener('DOMContentLoaded', () => {
                            // API Key ุงูุฎุงุต ุจุงููุดุฑู - ููุท ุงููุดุฑู ูููู ูุฐุง
                            const ADMIN_API_KEY = 'Moaaz2005@';

                            function tryOpenAdmin() {
                                const input = prompt('ุฃุฏุฎู ููุชุงุญ ุงูุฅุฏุงุฑุฉ:');
                                if (!input) return;
                                if (input === ADMIN_API_KEY) {
                                    // ุงุณุชุฎุฏู ุงููุชุบูุฑ ุงูุนุงููู
                                    window.isAdminAuthenticated = true;
                                    document.getElementById('admin-upload').classList.remove('hidden');
                                    alert('โ ูุฑุญุจุง ุจู ูู ููุญุฉ ุฅุฏุงุฑุฉ ุงูููุชุจุฉ');
                                    // ุฅุนุงุฏุฉ ุนุฑุถ ุชูุงุตูู ุงููุชุงุจ ุงูุญุงูู ุฅุฐุง ูุงูุช ููุชูุญุฉ ููู ูุธูุฑ ุฒุฑ ุงูุญุฐู
                                    if (window.currentBookId) {
                                        const b = booksData.find(x => x.id === window.currentBookId);
                                        if (b) showBookDetails(b);
                                    }
                                } else {
                                    alert('โ ููุชุงุญ ุงูุฅุฏุงุฑุฉ ุบูุฑ ุตุญูุญ. ูุญุงููุฉ ุฏุฎูู ุบูุฑ ูุตุฑุญ ุจูุง ูุฏ ุชุณุฌู.');
                                    console.warn('ูุญุงููุฉ ุฏุฎูู ูุงุดูุฉ ูููุญุฉ ุงูุฅุฏุงุฑุฉ');
                                }
                            }
                            document.addEventListener('keydown', (e) => {
                                if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'q') {
                                    e.preventDefault();
                                    tryOpenAdmin();
                                }
                            });
                            const secretBtn = document.getElementById('secret-admin-btn');
                            if (secretBtn) {
                                secretBtn.addEventListener('click', (e) => {
                                    e.preventDefault();
                                    tryOpenAdmin();
                                });
                            }
                            const closeBtn = document.getElementById('close-admin');
                            if (closeBtn) {
                                closeBtn.addEventListener('click', () => {
                                    document.getElementById('admin-upload').classList.add('hidden');
                                });
                            }

                            // ุฏุงูุฉ ุญุฐู ุงููุชุงุจ - ุชุญูุธ ุญุงูุฉ ุงูุญุฐู ูุญููุงู ูู localStorage ูุชุญุฏูุซ ุงูุนุฑุถ
                            window.deleteBook = function(bookId) {
                                if (!window.isAdminAuthenticated) {
                                    alert('ููุณ ูุฏูู ุตูุงุญูุฉ ุญุฐู ุงููุชุจ.');
                                    return;
                                }
                                const book = booksData.find(b => b.id === bookId);
                                if (!book) {
                                    alert('ุงููุชุงุจ ุบูุฑ ููุฌูุฏ ุฃู ุชู ุญุฐูู ุณุงุจูุงู.');
                                    return;
                                }
                                const ok = confirm('ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุญุฐู "' + book.title + '"ุ ูุฐู ุงูุนูููุฉ ุณุชุฎูู ุงููุชุงุจ ูู ุงููููุน.');
                                if (!ok) return;
                                // ุญูุธ ูู ูุงุฆูุฉ ุงููุญุฐููุงุช
                                const deleted = loadDeletedList();
                                if (!deleted.includes(bookId)) deleted.push(bookId);
                                saveDeletedList(deleted);
                                // ุฅุฒุงูุฉ ูู ุงููุงุฆูุฉ ุงูุญุงููุฉ
                                booksData = booksData.filter(b => b.id !== bookId);
                                // ุชุญุฏูุซ ุงูุนุฑุถ ูุงูุนูุฏุฉ ูููุงุฆูุฉ
                                renderBooks();
                                showBookList();
                                alert('โ ุชู ุญุฐู ุงููุชุงุจ ูุญููุงู. ููุงุญุธุฉ: ุงููููุงุช ุนูู ุงูุฎุงุฏู ูู ุชูุญุฐู ุชููุงุฆูุงู.');
                            };

                            // (ุชูุช ุฅุฒุงูุฉ ูุนุงูุฌุฉ ุงูุฅุฑุณุงู ุงููุฏููุฉ ููุง - ูุชู ุงูุขู ุงูุชุนุงูู ูุน ุงูุฅุฑุณุงู ูู ููู js/upload.js)
                        });


    </script>

</body>
</html>